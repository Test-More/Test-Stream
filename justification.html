<dl class="listnav">
    <dt id="testability">Testability</dt>
    <dd>
        <h2>It is hard to test Test-Builder!</h2>

        This is one of the more ironic problems, and is the problem that
        initially prompted Test-Stream.
        <p>

        <h3>Ways to test your testing tools:</h3>
        <dl class="descriptive_points">
            <dt>Test::Tester</dt>           <dd>Verify objects, limited support</dd>
            <dt>Test::Builder::Tester</dt>  <dd>String comparison of TAP output</dd>
            <dt>Parse TAP yourself</dt>     <dd>Even more fragile</dd>
            <dt>Don't test</dt>             <dd>What could happen?</dd>
        </dl>

        None of these options are ideal. They all either have limited support
        for what you can test, or are easily broken by minor changes to TAP or
        even diagnostics messages.

        <p>

        Test::Stream was concieved after David Golden (XDG) submitted
        <a href="https://github.com/Test-More/test-more/pull/396">this pull request</a>.
        It changed the indentation of a comment intended for human consumption,
        but broke downstream tool tests.
    </dd>

    <dt id="concurrency">Concurrency</dt>
    <dd>
        <h2>Test-Builder has laughable concurrency support</h2>

        If you want to run tests concurrently you have 4 options:

        <dl class="descriptive_points">
            <dt>Threads</dt>
            <dd>
                Threads in perl are discouraged and prone to problems. Threads
                are also no help when you want to test code that forks. This
                also breaks for subtests.
            </dd>
            <dt>Test::SharedFork</dt>
            <dd>
                This essentially does the same thing as the thread support, but
                uses shared memory to share between processes.
            </dd>
            <dt>Manual Plan + no numbers</dt>
            <dd>This works, but is hard to debug, and offers no help.</dd>
            <dt>Manual Synchronization</dt>
            <dd>Many have tried</dd>
        </dl>

        None of these options are ideal, and most have major gotchas. One major
        thing none of these addresses is the fact that the parent can exit true
        before a child finishes hiding some error conditions from the harness.
    </dd>

    <dt id="extendability">Extendability</dt>
    <dd>
        <h2>Test-Builder is not extendable by design</h2>
        If you want to fire off some 'ok' lines with diagnostics then you are
        set. If you want to do anything else you are out of luck.

        <dl class="descriptive_points">
            <dt>Singleton</dt>
            <dd>
                Test::Builder is a singleton. Subclassing is not ideal since
                you must replace or rebless the singleton. What if multiple
                tools each try to replace the singleton?
            </dd>
            <dt>Level</dt>
            <dd>
                <script class="code">
                    local $Test::Builder::Level = $Test::Builder::Level + 1;
                </script>
                $Level is obscure, most people never notice it. Those that do
                quickly start to hate it. It is also a terrible interface.
            </dd>
            <dt>No Hooks / Monkeypatching</dt>
            <dd>
                Test::Builder does not provide any way to hook into ok, diag,
                or any other type of event. As a result there are many modules
                on cpan that monkeypatch Test::Builder by wrapping its methods.
                These tools do not always play nicely together.
            </dd>
            <dt>Only TAP</dt>
            <dd>
                Test-Builder assumes above all else that TAP is all anyone
                would ever want. If you do not want TAP, or want a different
                TAP standard you are out of luck.
            </dd>
            <dt>Subtests</dt>
            <dd>
                Subtests require independant state. Tools cached the old
                singleton. Subtests work by replacing the internals of the
                singleton reference, then restoring them later. This is
                multiple levels of crazy.
            </dd>
        </dl>
    </dd>

    <dt id="qa">QA Findings</dt>
    <dd>
        <h2>QA Hackathon 2015 in Berlin</h2>

        During the hackathon we had a <I>long</I> discussion about Test-Builder. Here is a summary of the findings:

        <ul>
            <li>Test-Builder has severe limitations and could benefit from new development.</li>
            <li>Updating Test-Builder is acceptible, new development does not need to be a fork.</li>
            <li>Test-Stream appears to address most of the limitations of Test-Builder.</li>
            <li>We produced a list of things that must be done before Test-Builder on Test-Stream is released.</li>
        </ul>
    </dd>
</dl>
